document.addEventListener("DOMContentLoaded",function(l){function n(){if(self.innerHeight)return self.innerWidth;if(document.documentElement&&document.documentElement.clientHeight)return document.documentElement.clientWidth;if(document.body)return document.body.clientWidth}var c=[],m=[],g=[],h={},p=[],q,r=document.getElementsByTagName("ul")[0],k=document.getElementsByTagName("body")[0],f=new WE.map("earth_div",{sky:!0,atmosphere:!0});WE.tileLayer("http://otile2.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",
{attribution:"Tiles Courtesy of MapQuest."}).addTo(f);q=setInterval(function(){var a=f.getPosition();a[0]&&a[1]&&f.setCenter([a[0],a[1]+.1])},30);document.getElementById("open-side-menu").addEventListener("click",function(){k.classList.toggle("open")},!1);var s=function(a){g=[];p=[];for(var b=0;b<a.length;b++){if(!(a[b].id in h)){var c=a[b].id,d;d=a[b].online;d="rgba("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+", "+(d?1:.25)+")";h[c]={color:d,
beats:a[b].heartbeats}}a[b].heartbeats>h[a[b].id].beats&&(p.push(a[b].id),h[a[b].id].beats=a[b].heartbeats);c=a[b].location.country;-1===g.indexOf(c)&&g.push(c)}};l=function(){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&200===a.status&&(c=JSON.parse(a.responseText).farmers.filter(function(a){return 0<Math.round(a.uptime)}),s(c),t())};a.open("GET","http://verify.driveshare.org/api/downstream/status/list/by/d/uptime");a.send()};l();setInterval(l,5E3);var u=function(a){a=
-1!==a.indexOf("#")?[hexToR(a),hexToG(a),hexToB(a)]:a.replace("rgb(","").replace(")","").split(",");return 130<(299*a[0]+587*a[1]+114*a[2])/1E3?"highlightBlack":"highlightWhite"},t=function(){if(c.length){r.innerHTML=null;document.getElementById("no-farmers").style.display="none";for(var a=document.createDocumentFragment(),b=0;b<c.length;b++){var e=document.createElement("li");e.setAttribute("id","farmer"+(b+1));e.className="entry "+(c[b].online?"":"offline");var d=document.createElement("span");
d.className="color-effect";d.style.backgroundColor=h[c[b].id].color;e.appendChild(d);d=document.createElement("div");d.className="farmerId";d.innerHTML=c[b].address;e.appendChild(d);d=document.createElement("span");d.className="count";d.innerHTML=Math.round(c[b].uptime)+"%";e.appendChild(d);a.appendChild(e)}r.appendChild(a);document.getElementsByClassName("summary")[0].innerHTML=c.length+" farmers <span>/</span> "+g.length+" countries"}else r.innerHTML=null,document.getElementById("no-farmers").style.display=
"block",document.getElementsByClassName(".summary")[0].innerHTML="";m.forEach(function(a){f.removeMarker(a)});m=[];c.forEach(function(a){var b=a.location.country,c=a.location.city,d=a.location.state,e=a.contracts,g=a.heartbeats,k=a.size,l=a.address.slice(0,4);m.push(WE.marker([a.location.lat,a.location.lon]).addTo(f).bindPopup("Farmer <strong>"+l+"</strong>&hellip; from <strong>"+(c?c:b)+"</strong>"+(d?", <strong>"+d+"</strong>":"")+" has <strong>"+e+"</strong> contract(s) and passed <strong>"+g+
"</strong> heartbeats with "+k+"-byte test files.",{maxWidth:150,maxHeight:100,closeButton:!0}));b=m[m.length-1].element.firstChild;b.style.background=h[a.id].color;-1<p.indexOf(a.id)?b.classList.add("beat"):a.online||b.classList.add("offline")});a=document.getElementsByClassName("entry");for(b=0;b<a.length;b++)a[b].addEventListener("click",function(){800>n()&&k.classList.remove("open");clearInterval(q);var a=this.getAttribute("id").split("farmer")[1]-1;f.panTo([c[a].location.lat,c[a].location.lon])}),
a[b].addEventListener("mouseover",function(){this.classList.add(u(this.getElementsByClassName("color-effect")[0].style.backgroundColor))}),a[b].addEventListener("mouseout",function(){this.classList.remove("highlightWhite");this.classList.remove("highlightBlack")})},v=document.getElementById("earth_div");["click","touchstart","touchend"].forEach(function(a){v.addEventListener(a,function(){clearInterval(q);800>n()&&k.classList.remove("open")})});800<n()?k.classList.add("open"):f.setZoom(1.8)});